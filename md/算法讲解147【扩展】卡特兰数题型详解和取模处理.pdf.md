卡特兰数题型详解和取模处理

前置知识
讲解097 - 欧拉筛，最⼩质因⼦筛法         因⼦计数法计算卡特兰数，需要最⼩质因⼦表
讲解099 - 逆元和除法同余     卡特兰数计算公式的实现，需要阶乘余数表、阶乘逆元表、连续数逆元表

本节课讲述

卡特兰数的三种题⽬类型

不同取模要求下的处理，算法竞赛的同学必须掌握，尤其是本节课题⽬5重点讲述的因⼦计数法

卡特兰数的九道经典题⽬

左程云

卡特兰数题型详解和取模处理

卡特兰数
[ 1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862, 16796, 58786, 208012, 742900 ..]
  0  1  2  3   4   5    6    7     8     9     10     11      12      13 ..

四个公式都是卡特兰数公式

公式1、公式2、公式3时间复杂度O(n)

公式4时间复杂度O(n平⽅)

经常根据数据状况、取模要求来选择公式

左程云

卡特兰数题型详解和取模处理

卡特兰数题⽬类型1 - 进出栈模型

进栈顺序规定为1、2、3..n，返回有多少种不同的出栈顺序

课上重点图解，该问题如何转化为公式1

很多题⽬都是进出栈模型，本质都是卡特兰数，这⾥再列三个
1，⻔票5元，卖票⼈没钱，n个游客只有5元，n个游客只有10元，确保顺利找零，返回排队的⽅法数
2，有n个1和n个-1，要组成2n⻓度的数列，保证任意前缀和>=0，有多少种排列⽅法
3，圆上有2n个点，这些点成对连接起来，形成n条线段，任意两条线段不能相交，返回连接的⽅法数

左程云

卡特兰数题型详解和取模处理

卡特兰数题⽬类型2 - 路径计数模型

正⽅形中，(0,0)到(n,n)，每⼀步只能向上或向右，可以碰对⻆线但不能⾛出右下半区，路径有⼏种

课上重点图解，该问题如何转化为公式1

掌握卡特兰数的路径计数模型后，利⽤类似的分析⽅法，可以解决更多类似的路径计数问题

正⽅形中，(0,0)到(n,n)，每⼀步只能向上或向右，除了起点和终点外，不碰对⻆线，路径有⼏种

答案为

还有题⽬6，也是类似的分析⽅法

左程云

卡特兰数题型详解和取模处理

卡特兰数题⽬类型3 - 划分左右相乘模型

有n+2条边的凸多边形，通过顶点连线的⽅式，完全划分为三⻆形，连线不能相交，返回划分的⽅法数

⼀共有n个节点，认为节点之间⽆差别，返回能形成多少种不同结构的⼆叉树

课上重点图解，这两个问题如何转化为公式4

左程云

卡特兰数题型详解和取模处理

题⽬1
卡特兰数模版
进栈顺序规定为1、2、3..n，返回有多少种不同的出栈顺序
测试题⽬的数据量很⼩，得到的卡特兰数没有多⼤，不需要取模处理
但是请假设，当n⽐较⼤时，卡特兰数是很⼤的，答案对 1000000007 取模
测试链接 : https://www.luogu.com.cn/problem/P1044

务必掌握讲解099 - 逆元和除法同余，讲述了阶乘余数表、阶乘逆元表、连续数逆元表的⽣成过程
公式1：阶乘余数表、阶乘逆元表
公式2：阶乘余数表、阶乘逆元表、求单独数字的逆元
公式3：连续数逆元表
公式4：不需要额外的表，简单的乘法同余、加法同余
公式1、公式2、公式3的时间复杂度O(n)，公式4的时间复杂度O(n平⽅)
公式4不需要，阶乘余数表、阶乘逆元表、连续数逆元表，因为公式4没有⽤到除法同余

左程云

卡特兰数题型详解和取模处理

题⽬2
圆上连线
圆上有2n个点，这些点成对连接起来，形成n条线段，任意两条线段不能相交，返回连接的⽅法数
注意！答案不对 10^9 + 7 取模！⽽是对 10^8 + 7 取模！
1 <= n <= 2999
测试链接 : https://www.luogu.com.cn/problem/P1976

左程云

卡特兰数题型详解和取模处理

题⽬3
任意前缀上红多于⿊
有n个红和n个⿊，要组成2n⻓度的数列，保证任意前缀上，红的数量 >= ⿊的数量
返回有多少种排列⽅法，答案对 100 取模
1 <= n <= 100
测试链接 : https://www.luogu.com.cn/problem/P1722

左程云

卡特兰数题型详解和取模处理

题⽬4
不同结构的⼆叉树数量
⼀共有n个节点，认为节点之间⽆差别，返回能形成多少种不同结构的⼆叉树
1 <= n <= 19
测试链接 : https://leetcode.cn/problems/unique-binary-search-trees/

左程云

卡特兰数题型详解和取模处理

卡特兰数的取模处理

求解卡特兰数第n项，答案对p取模，有如下⼏种数据状况
情况1，n是<=35规模，答案不会溢出long类型的范围，往往不取模就返回真实值，使⽤：公式4
情况2，n是10^3规模，p为质数，使⽤：公式1、公式2、公式3、公式4
情况3，n是10^3规模，p可能是质数也可能是合数，使⽤：公式4
情况4，n是10^6规模，p为质数，使⽤：公式1、公式2、公式3
情况5，n是10^6规模，p可能是质数也可能是合数，使⽤：公式2 + 因⼦计数法

通过题⽬5重点讲解，公式2 + 因⼦计数法

情况6，n是10^3规模，题⽬要求打印⻓度很⼤的真实结果，这就是题⽬8的要求
情况7，n是10^6规模，题⽬要求打印⻓度很⼤的真实结果，这是不可能的，不取模⼀定算不完

左程云

卡特兰数题型详解和取模处理

题⽬5
有趣的数列(重要! 因⼦计数法)
求第n项卡特兰数，要求答案对p取模
1 <= n <= 10^6
1 <= p <= 10^9
p可能不为质数
测试链接 : https://www.luogu.com.cn/problem/P3200

公式2 + 因⼦计数法，需要最⼩质因⼦表，务必掌握讲解097，欧拉筛

课上重点图解，因⼦计数法的过程

1~n范围上的质因⼦差不多 n/(log n) 个，每个质因⼦求快速幂O(log n)
总复杂度 = 欧拉筛O(n) + 因⼦计数过程O(n) + 所有质因⼦计算快速幂O(n)

左程云

卡特兰数题型详解和取模处理

题⽬6
⽣成字符串
有n个1和m个0，要组成n+m⻓度的数列，保证任意前缀上，1的数量 >= 0的数量
返回有多少种排列⽅法，答案对 20100403 取模
1 <= m <= n <= 10^6
测试链接 : https://www.luogu.com.cn/problem/P1641

左程云

卡特兰数题型详解和取模处理

题⽬7
不含递增三元组的排列⽅法数
数字从1到n，可以形成很多排列，要求任意从左往右的三个位置，不能出现依次递增的样⼦
返回排列的⽅法数，答案对 1000000 取模
1 <= n <= 1000
测试链接 : https://www.luogu.com.cn/problem/SP7897
测试链接 : https://www.spoj.com/problems/SKYLINE

这个问题设定不复杂，并且结论居然是卡特兰数，挺有趣，但是⽬前为⽌，我没有想到合理的解释
我是⽤暴⼒⽅法⽣成全部排列，然后把符合要求的数量打印出来，发现是卡特兰数
所以提醒⼀下，⼊参简单的问题，莫不如⽤暴⼒⽅法得到前⼏项，然后观察出答案是什么
建议记住卡特兰数前⼏项：1, 1, 2, 5, 14, 42, 132..
如果你有⽐较好的解释，欢迎评论留⾔！

左程云

卡特兰数题型详解和取模处理

题⽬8
树屋阶梯
地⾯⾼度是0，想搭建⼀个阶梯，要求每⼀个台阶上升1的⾼度，最终到达⾼度n
有⽆穷多任意规格的矩形材料，但是必须选择n个矩形，希望能搭建出阶梯的样⼦
返回搭建阶梯的不同⽅法数，答案可能很⼤，不取模！就打印真实答案
1 <= n <= 500
测试链接 : https://www.luogu.com.cn/problem/P2532

java同学可以直接使⽤BigInteger

C++同学需要⾃⼰实现⾼精度乘法

左程云

卡特兰数题型详解和取模处理

题⽬9
叶⼦节点数的期望
⼀共有n个节点，认为节点之间⽆差别，能形成很多不同结构的⼆叉树
假设所有不同结构的⼆叉树，等概率出现⼀棵，返回叶⼦节点的期望
1 <= n <= 10^9
答案误差⼩于10的-9次⽅
测试链接 : https://www.luogu.com.cn/problem/P3978

左程云

