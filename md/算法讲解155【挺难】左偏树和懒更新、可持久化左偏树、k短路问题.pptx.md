<!-- Slide number: 1 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
前置知识
讲解025 - 堆结构
讲解059 - 链式前向星建图
讲解064 - dijkstra算法，本节课题目5需要
讲解110 - 线段树，理解线段树的懒更新机制，本节课题目1、题目2需要
讲解154 - 左偏树基础，理解左偏树删除任意编号节点的复杂度分析，本节课题目2需要

上节课讲述
左偏树原理、合并、删除堆顶、删除任意编号节点、左偏树相关题目

本节课讲述
左偏树结合懒更新操作，题目1，题目2
可持久化左偏树，题目3、题目4
可持久化左偏树实现k短路问题最优解，题目5

<!-- Slide number: 2 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
左偏树结合懒更新操作
1，整棵树如果想更新，只在头节点设置懒更新信息
2，merge、pop或者其他任务到来时，再把懒更新信息下发到左右子树
3，左偏树上的懒更新，依然是能懒则懒的机制，与线段树的懒更新没有区别

<!-- Slide number: 3 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
题目1
城市攻占
一共有n个城市，1号城市是城市树的头，每个城市都有防御值、上级城市编号、奖励类型、奖励值
如果奖励类型为0，任何骑士攻克这个城市后，攻击力会加上奖励值
如果奖励类型为1，任何骑士攻克这个城市后，攻击力会乘以奖励值
输入保证，任何城市的上级编号 < 这座城市的编号，1号城市没有上级城市编号、奖励类型、奖励值
一共有m个骑士，每个骑士都有攻击力、第一次攻击的城市
如果骑士攻击力 >= 城市防御值，当前城市会被攻占，骑士获得奖励，继续攻击上级城市
如果骑士攻击力  < 城市防御值，那么骑士会在该城市牺牲，没有后续动作了
所有骑士都是独立的，不会影响其他骑士攻击这座城池的结果
打印每个城市牺牲的骑士数量，打印每个骑士攻占的城市数量
1 <= n、m <= 3 * 10^5，攻击值的增加也不会超过long类型范围
测试链接 : https://www.luogu.com.cn/problem/P3261

<!-- Slide number: 4 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
题目2
棘手的操作
编号1~n个节点，每个节点独立且有自己的权值，实现如下7种操作，操作一共调用m次
U x y  : x所在的集合和y所在的集合合并
A1 x y : x节点的权值增加y
A2 x y : x所在的集合所有节点的权值增加y
A3 x   : 所有节点的权值增加x
F1 x   : 打印x节点的权值
F2 x   : 打印x所在的集合中，权值最大的节点的权值
F3     : 打印所有节点中，权值最大的节点的权值
1 <= n、m <= 3 * 10^5，权值不会超过int类型的范围
测试链接 : https://www.luogu.com.cn/problem/P3273

懒更新只维持在左偏树的顶部，变成了整个集合的属性，这属于启发式合并的内容，后面的课安排讲述

<!-- Slide number: 5 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
可持久化左偏树的功能
1，每个版本的左偏树一旦生成，该版本会保持不变，可以生成多个版本的左偏树
2，不再结合并查集，所有操作需要提供头节点编号，进行查询、合并、弹出树头等操作
3，生成一个版本的左偏树，时间复杂度O(log n)，空间复杂度O(log n)

可持久化左偏树的设计，类似于FHQ Treap的可持久化设计
1，合并过程中，沿途拷贝老节点的值，建立出新编号的节点，使得过去版本的左偏树不受影响
2，弹出堆顶的过程中，新的头节点拷贝老节点的值，然后合并左右树
3，不同版本的左偏树，各自记录头节点编号

课上重点图解，可持久化左偏树

<!-- Slide number: 6 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
题目3
可持久化左偏树的实现
网上几乎没有可持久化左偏树的模版练习题
所以采用对数器验证正确性

<!-- Slide number: 7 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
题目4
Y的积木，可持久化左偏树实现最优解
一共有n个正数数组，给定每个数组的大小mi，以及每个数组的数字
每个数组必须选且只能选一个数字，就可以形成n个数字的挑选方案
所有这些方案中，有数字累加和第1小的方案、第2小的方案、第3小的方案...
打印，累加和前k小的方案，各自的累加和，要求实现O(k * log k)的解
1 <= n、mi <= 100
1 <= k <= 10^4
1 <= 数字 <= 100
测试链接 : https://www.luogu.com.cn/problem/P2409

分组背包和其他方法能通过，但不是最优解，可持久化左偏树的解法能做到最优解

<!-- Slide number: 8 -->
# 左偏树和懒更新、可持久化左偏树、k短路问题
左程云
题目5
K短路问题，可持久化左偏树实现最优解
有n个点编号1~n，有m条边，每条边都是正数边权，组成有向带权图
从1号点走到n号点，就认为是一次旅行
一次旅行中，边不能重复选，点可以重复经过，如果到达了n号点，那么旅行立刻停止
从1号点走到n号点，会有很多通路方案，通路方案的路费为选择边的边权累加和
虽然每次旅行都是从1号点到n号点，但是你希望每次旅行的通路方案都是不同的
任何两次旅行，只要选择的边稍有不同，就认为是不同的通路方案
你的钱数为money，用来支付路费，打印你一共能进行几次旅行
测试链接 : https://www.luogu.com.cn/problem/P2483

A*算法和其他方法能通过，但不是最优解，可持久化左偏树的解法能做到最优解