<!-- Slide number: 1 -->
# 左偏树的原理、代码、相关题目
左程云
前置知识
讲解025 - 堆结构
讲解052 - 单调栈，本节课题目5需要
讲解056、讲解057 - 并查集原理 & 给集合打标签的技巧

本节课讲述
左偏树原理、合并、删除堆顶，题目1
左偏树删除任意编号的节点，题目2
左偏树的相关题目，题目3、题目4、题目5

下节课讲述
左偏树结合懒更新操作、可持久化左偏树、k短路问题

<!-- Slide number: 2 -->
# 左偏树的原理、代码、相关题目
左程云
左偏树是一种可并堆结构，支持堆的合并，两个堆的合并过程，时间复杂度O(log n)

可并堆结构还有，配对堆、斜堆、二项堆、斐波那契堆等等
左偏树因为方便进行可持久化，所以只学习左偏树即可，下节课会讲述可持久化左偏树

左偏树表示的堆结构，不是完全二叉树，而是广义的堆结构，平衡性由dist值来维护
节点的dist值表示，离开该节点后，至少经过几个节点能到达空，dist[0] = -1
合并后如果发现，左儿子dist值 < 右儿子dist值，就交换左右树
左偏树的每个节点满足，左儿子dist值 >= 右儿子dist值，节点dist值 = 右儿子dist值 + 1

课上重点图解，左偏树合并的过程，重点是理解合并总发生在右树上，以及交换左右树的过程

左偏树的平衡性，只是方便了合并的过程，树上依然可能出现很长的链，所以查询快需要结合并查集

<!-- Slide number: 3 -->
# 左偏树的原理、代码、相关题目
左程云
左偏树结构，合并操作非常方便，但是树上依然可能出现很长的链
任何节点找堆顶的过程，不能依赖左偏树的结构，所以建立并查集

利用并查集压缩路径的特点，任何节点找堆顶的过程就得到了加速
需要保证，并查集最上方的代表节点 = 左偏树的头也就是堆顶

左偏树删除堆顶节点
1，堆顶节点的左右树合并，形成新树
2，堆顶节点的left、right、dist信息清空
3，堆顶节点的father指向新树的头，很重要！课上会重点解释

课上重点图解，左偏树删除堆顶节点的过程

<!-- Slide number: 4 -->
# 左偏树的原理、代码、相关题目
左程云
题目1
左偏树模版
依次给定n个非负数字，表示有n个小根堆，每个堆只有一个数
实现如下两种操作，操作一共调用m次
1 x y : 第x个数字所在的堆和第y个数字所在的堆合并
        如果两个数字已经在一个堆或者某个数字已经删除，不进行合并
2 x   : 打印第x个数字所在堆的最小值，并且在堆里删掉这个最小值
        如果第x个数字已经被删除，也就是找不到所在的堆，打印-1
        若有多个最小值，优先删除编号小的
1 <= n, m <= 10^5
测试链接 : https://www.luogu.com.cn/problem/P3377
测试链接 : https://www.luogu.com.cn/problem/P2713

<!-- Slide number: 5 -->
# 左偏树的原理、代码、相关题目
左程云
左偏树删除任意编号的节点
1，建立树上父节点信息up数组，树上真实父节点信息up != 并查集的路径信息father
2，假设删除节点为i，整棵树的头假设为h，节点i的左右树合并，形成的树假设为s
3，假设节点i的树上父节点为f，去掉节点i，节点f和节点s直接连在一起
4，从s节点往上，更新节点的dist值，如果发现，左儿子dist < 右儿子dist，就交换左右树
5，需要保证每个节点的up、left、right、dist、father信息更新正确

核心在于第4点，保证左偏树的性质，修改节点总数为O(log n)

课上重点图解，删除任意节点的过程，重点解释第4点

<!-- Slide number: 6 -->
# 左偏树的原理、代码、相关题目
左程云
题目2
断罪者，删除任意编号节点
给定t，w，k，表示一共有t个人，死亡方式都为w，地狱阈值都为k，w和k含义稍后解释
每个人都给定n和m，表示这人一生有n件错事，有m次领悟
这个人的n件错事，给定对应的n个罪恶值，然后给定m次领悟，领悟类型如下
2 a   : 第a件错事的罪恶值变成0
3 a b : 第a件错事所在的集合中，最大罪恶值的错事，罪恶值减少b
        如果减少后罪恶值变成负数，认为这件错事的罪恶值变为0
        如果集合中，两件错事都是最大的罪恶值，取编号较小的错事
4 a b : 第a件错事所在的集合与第b件错事所在的集合合并
一个错事集合的罪恶值 = 这个集合中的最大罪恶值，只取一个
一个人的罪恶值 = 这个人所有错事集合的罪恶值累加起来
(接下页)

<!-- Slide number: 7 -->
# 左偏树的原理、代码、相关题目
左程云
题目2
(接上页)
最后根据死亡方式w，对每个人的罪恶值做最后调整，然后打印这个人的下场
如果w==1，不调整
如果w==2，人的罪恶值 -= 错事集合的罪恶值中的最大值
如果w==3，人的罪恶值 += 错事集合的罪恶值中的最大值
如果一个人的罪恶值 == 0，打印"Gensokyo 0"
如果一个人的罪恶值  > k，打印"Hell "，然后打印罪恶值
如果一个人的罪恶值 <= k，打印"Heaven "，然后打印罪恶值
一共有t个人，所以最终会有t次打印
1 <= t <= 30
1 <= n <= 2 * 10^6
错事罪恶值可能很大，输入保证每个人的罪恶值用long类型不溢出
测试链接 : https://www.luogu.com.cn/problem/P4971

<!-- Slide number: 8 -->
# 左偏树的原理、代码、相关题目
左程云
题目3
猴王
给定n只猴子的战斗力，一开始每个猴子都是独立的阵营
一共有m次冲突，每次冲突给定两只猴子的编号x、y
如果x和y在同一阵营，这次冲突停止，打印-1
如果x和y在不同阵营，x所在阵营的最强猴子会和y所在阵营的最强猴子进行打斗
打斗的结果是，两个各自阵营的最强猴子，战斗力都减半，向下取整，其他猴子战力不变
然后两个阵营合并，打印合并后的阵营最大战斗力
题目可能有多组数据，需要监控输入流直到结束
1 <= n, m <= 10^5
0 <= 猴子战斗力 <= 32768
测试链接 : https://www.luogu.com.cn/problem/P1456

<!-- Slide number: 9 -->
# 左偏树的原理、代码、相关题目
左程云
题目4
派遣
一共有n个忍者，每个忍者有上级编号、工资、能力，三个属性
输入保证，任何忍者的上级编号 < 这名忍者的编号，1号忍者是整棵忍者树的头
你一共有m的预算，可以在忍者树上随意选一棵子树，然后在这棵子树上挑选忍者
你选择某棵子树之后，不一定要选子树头的忍者，只要不超过m的预算，可以随意选择子树上的忍者
最终收益 = 雇佣人数 * 子树头忍者的能力，返回能取得的最大收益是多少
1 <= n <= 10^5           1 <= m <= 10^9
1 <= 每个忍者工资 <= m     1 <= 每个忍者领导力 <= 10^9
测试链接 : https://www.luogu.com.cn/problem/P1552

左偏树 + 并查集的集合增加信息 + 贪心

<!-- Slide number: 10 -->
# 左偏树的原理、代码、相关题目
左程云
题目5
数字序列
给定一个长度为n的数组A，要求构造出一个长度为n的递增数组B
希望 |A[1] - B[1]| + |A[2] - B[2]| + ... + |A[n] - B[n]| 最小
打印这个最小值，然后打印数组B，如果有多个方案，只打印其中的一个
1 <= n <= 10^6
0 <= A[i] <= 2^32 - 1
测试链接 : https://www.luogu.com.cn/problem/P4331

递增构造转化为不降序构造 + 贪心 + 上中位数单调栈 + 左偏树维护上中位数