<!-- Slide number: 1 -->
# 带权并查集的原理和扩展题目
左程云
前置知识
讲解056、讲解057 - 并查集

本节课讲述

带权并查集的原理和模版，题目1，题目2，题目3
带权并查集维护距离关系，题目4
带权并查集维护倍数关系，题目5
带权并查集维护种类关系，题目6
经典并查集解决分类问题，题目7、题目8
带权并查集维护异或关系，题目9

<!-- Slide number: 2 -->
# 带权并查集的原理和扩展题目
左程云
带权并查集的原理，一维数轴相对距离模型
1，点权代表当前节点到集合头节点的距离，并不保证实时正确，可以经过find过程修正正确
2，void union(l, r, v)，l和r属于两个集合，并且l到r距离为v，合并两个集合
    find(l)头为lf，find(r)头rf，find过程会修正dist[l]和dist[r]
    father[lf] = rf
    dist[lf] = dist[r] - dist[l] + v
3，int find(i)，寻找i所在集合的头，同时修正dist[i]的值
    路径压缩之前i的父为t，路径压缩之后，dist[i] += dist[t]
4，int query(l, r)，查询l和r之间的距离关系
    find(l) == find(r)，才有距离关系，距离 = dist[l] - dist[r]

课上重点图解

带权并查集的所有变化，都来自一维数轴相对距离模型

<!-- Slide number: 3 -->
# 带权并查集的原理和扩展题目
左程云
题目1
推导部分和，带权并查集模版题1
有n个数字，下标1 ~ n，但是并不知道每个数字是多少
先给出m个数字段的累加和，再查询q个数字段的累加和
给出数字段累加和的操作 l r v，代表l~r范围上的数字，累加和为v
查询数字段累加和的操作 l r，代表查询l~r范围上的数字累加和
请根据m个给定，完成q个查询，如果某个查询无法给出答案，打印"UNKNOWN"
1 <= n, m, q <= 10^5
累加和不会超过long类型范围
测试链接 : https://www.luogu.com.cn/problem/P8779

<!-- Slide number: 4 -->
# 带权并查集的原理和扩展题目
左程云
题目2
狡猾的商人，带权并查集模版题2
有n个月的收入，下标1 ~ n，但是并不知道每个月收入是多少
操作 l r v，代表从第l个月到第r个月，总收入为v
一共给你m个操作，请判断给定的数据是自洽还是自相矛盾
自洽打印true，自相矛盾打印false
1 <= n <= 100    1 <= m <= 1000
总收入不会超过int类型范围
测试链接 : https://www.luogu.com.cn/problem/P2294

<!-- Slide number: 5 -->
# 带权并查集的原理和扩展题目
左程云
题目3
错误答案数量，带权并查集模版题3
有n个数字，下标1 ~ n，但是并不知道每个数字是多少
操作 l r v，代表l~r范围上累加和为v
一共m个操作，如果某个操作和之前的操作信息自相矛盾，认为当前操作是错误的，不进行这个操作
最后打印错误操作的数量
1 <= n <= 200000    1 <= m <= 40000
累加和不会超过int类型范围
测试链接 : https://acm.hdu.edu.cn/showproblem.php?pid=3038

<!-- Slide number: 6 -->
# 带权并查集的原理和扩展题目
左程云
题目4
银河英雄传说
一共有30000搜战舰，编号1~30000，一开始每艘战舰各自成一队
如果若干战舰变成一队，那么队伍里的所有战舰竖直地排成一列
实现如下两种操作，操作一共调用t次
M l r : 合并l号战舰所在队伍和r号战舰所在队伍
        l号战舰的队伍，整体移动到，r号战舰所在队伍的最末尾战舰的后面
        如果l号战舰和r号战舰已经是一队，不进行任何操作
C l r : 如果l号战舰和r号战舰不在一个队伍，打印-1
        如果l号战舰和r号战舰在一个队伍，打印它俩中间隔着几艘战舰
1 <= t <= 5 * 10^5
测试链接 : https://www.luogu.com.cn/problem/P1196

带权并查集合并时，利用并查集的大小，主动设置距离

<!-- Slide number: 7 -->
# 带权并查集的原理和扩展题目
左程云
题目5
除法求值
所有变量都用字符串表示，并且给定若干组等式
比如等式
["ab", "ef"] = 8，代表ab / ef = 8
["ct", "ef"] = 2，代表ct / ef = 2
所有等式都是正确的并且可以进行推断，给定所有等式之后，会给你若干条查询
比如查询，["ab", "ct"]，根据上面的等式推断，ab / ct = 4
如果某条查询中的变量，从来没在等式中出现过，认为答案是-1.0
如果某条查询的答案根本推断不出来，认为答案是-1.0
返回所有查询的答案
测试链接 : https://leetcode.cn/problems/evaluate-division/

带权并查集维护倍数关系

<!-- Slide number: 8 -->
# 带权并查集的原理和扩展题目
左程云
题目6
甄别食物链
一共有n只动物，编号1 ~ n，每只动物都是A、B、C中的一种，A吃B、B吃C、C吃A
一共有k句话，希望你判断哪些话是假话，每句话是如下两类句子中的一类
1 X Y : 第X只动物和第Y只动物是同类
2 X Y : 第X只动物吃第Y只动物
当前的话与前面的某些真话冲突，视为假话
当前的话提到的X和Y，有任何一个大于n，视为假话
当前的话如果关于吃，又有X==Y，视为假话
返回k句话中，假话的数量
1 <= n <= 5 * 10^4    1 <= k <= 10^5
测试链接 : https://www.luogu.com.cn/problem/P2024

带权并查集维护种类信息，%3的余数

<!-- Slide number: 9 -->
# 带权并查集的原理和扩展题目
左程云
题目7
关押罪犯
一共有n个犯人，编号1 ~ n，一共有两个监狱，你可以决定每个犯人去哪个监狱
给定m条记录，每条记录 l r v，表示l号犯人和r号犯人的仇恨值
每个监狱的暴力值 = 该监狱中仇恨最深的犯人之间的仇恨值
冲突值 = max(第一座监狱的暴力值，第二座监狱的暴力值)
犯人的分配方案需要让这个冲突值最小，返回最小能是多少
1 <= n <= 20000    1 <= m <= 100000    1 <= 仇恨值 <= 10^9
测试链接 : https://www.luogu.com.cn/problem/P1525

经典并查集做分类处理

<!-- Slide number: 10 -->
# 带权并查集的原理和扩展题目
左程云
题目8
团伙
注意洛谷关于本题的描述有问题，请按照如下的描述来理解题意
一共有n个黑帮成员，编号1 ~ n，发现了m条事实，每条事实一定属于如下两种类型中的一种
F l r : l号成员和r号成员是朋友
E l r : l号成员和r号成员是敌人
黑帮遵守如下的约定，敌人的敌人一定是朋友，是朋友必然来自同一黑帮，是敌人一定不是同一黑帮
如果根据事实无法推断出一个成员有哪些朋友，那么该成员自己是一个黑帮
输入数据不存在矛盾，也就是任何两人不会推出既是朋友又是敌人的结论
遵守上面的约定，根据m条事实，计算黑帮有多少个
1 <= n <= 1000    1 <= m <= 5000
测试链接 : https://www.luogu.com.cn/problem/P1892

经典并查集做分类处理

<!-- Slide number: 11 -->
# 带权并查集的原理和扩展题目
左程云
题目9
异或关系
一共n个数，编号0 ~ n-1，实现如下三种类型的操作，一共调用m次
I x v        : 声明 第x个数 = v
I x y v      : 声明 第x个数 ^ 第y个数 = v
Q k a1 .. ak : 查询 一共k个数，编号为a1 .. ak，这些数字异或起来的值是多少
对每个Q的操作打印答案，如果根据之前的声明无法推出答案，打印"I don't know."
如果处理到第s条声明，发现了矛盾，打印"The first s facts are conflicting."
注意只有声明操作出现，s才会增加，查询操作不占用声明操作的计数
发现矛盾之后，所有的操作都不再处理，更多的细节可以打开测试链接查看题目
1 <= n <= 20000    1 <= m <= 40000    1 <= k <= 15
测试链接 : https://acm.hdu.edu.cn/showproblem.php?pid=3234

带权并查集维护异或关系 + 虚点的设计 + 求解异或和逻辑整理